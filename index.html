<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Book Tracker</title>
Â  Â Â 
Â  Â  <link rel="icon" href="/book-tracker-2/favicon.ico" sizes="any">
Â  Â  <link rel="icon" type="image/svg+xml" href="/book-tracker-2/favicon.svg">
Â  Â  <link rel="apple-touch-icon" href="/book-tracker-2/apple-touch-icon.png">
Â  Â  <link rel="manifest" href="/book-tracker-2/site.webmanifest">
Â  Â  <meta name="theme-color" content="#111827">Â 
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â Â 
Â  Â  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
Â  Â  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
Â  Â Â 
Â  Â  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

Â  Â  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  background-color: #111827; /* bg-gray-900 */
Â  Â  Â  Â  }
Â  Â  Â  Â  .dragging {
Â  Â  Â  Â  Â  Â  opacity: 0.5;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Custom Styles for the Barcode Scanner --- */
Â  Â  Â  Â  .scanner-viewfinder {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  width: 300px;
Â  Â  Â  Â  Â  Â  height: 225px; /* 4:3 aspect ratio */
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem; /* rounded-lg */
Â  Â  Â  Â  Â  Â  border: 2px dashed #4b5563; /* border-gray-600 */
Â  Â  Â  Â  }

Â  Â  Â  Â  .scanner-viewfinder #reader {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  object-fit: cover;
Â  Â  Â  Â  }

Â  Â  Â  Â  .scanner-scan-line {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  height: 3px;
Â  Â  Â  Â  Â  Â  background: linear-gradient(90deg, transparent, #818cf8, transparent);
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 10px #818cf8;
Â  Â  Â  Â  Â  Â  animation: scan 2.5s infinite ease-in-out;
Â  Â  Â  Â  Â  Â  border-radius: 9999px;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes scan {
Â  Â  Â  Â  Â  Â  0% { transform: translateY(5px); }
Â  Â  Â  Â  Â  Â  50% { transform: translateY(calc(225px - 8px)); }
Â  Â  Â  Â  Â  Â  100% { transform: translateY(5px); }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="root"></div>

Â  Â  <script type="text/babel" data-type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
Â  Â  Â  Â  import {Â 
Â  Â  Â  Â  Â  Â  getAuth,Â 
Â  Â  Â  Â  Â  Â  onAuthStateChanged,Â 
Â  Â  Â  Â  Â  Â  createUserWithEmailAndPassword,Â 
Â  Â  Â  Â  Â  Â  signInWithEmailAndPassword,Â 
Â  Â  Â  Â  Â  Â  signOut
Â  Â  Â  Â  } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
Â  Â  Â  Â  import {Â 
Â  Â  Â  Â  Â  Â  getFirestore,Â 
Â  Â  Â  Â  Â  Â  collection,Â 
Â  Â  Â  Â  Â  Â  addDoc,Â 
Â  Â  Â  Â  Â  Â  query,Â 
Â  Â  Â  Â  Â  Â  where,Â 
Â  Â  Â  Â  Â  Â  getDocs,
Â  Â  Â  Â  Â  Â  doc,
Â  Â  Â  Â  Â  Â  updateDoc,
Â  Â  Â  Â  Â  Â  writeBatch,
Â  Â  Â  Â  Â  Â  deleteDoc
Â  Â  Â  Â  } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

Â  Â  Â  Â  const { useState, useEffect, useMemo, useRef, useCallback } = React;

Â  Â  Â  Â  // --- Firebase Configuration ---
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyCWiDK8pm24MEKDC8DmcR68VwgWKx2j5eM",
Â  Â  Â  Â  Â  Â  authDomain: "book-tracker-v2.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "book-tracker-v2",
Â  Â  Â  Â  Â  Â  storageBucket: "book-tracker-v2.appspot.com",
Â  Â  Â  Â  Â  Â  messagingSenderId: "148759504044",
Â  Â  Â  Â  Â  Â  appId: "1:148759504044:web:5332ca5553a0cd2a92ab09"
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- App Constants ---
Â  Â  Â  Â  const GOOGLE_BOOKS_API_KEY = 'AIzaSyAgt0khNLPhJCSonZ_xvwnRewy3xSByLz0';
Â  Â  Â  Â  const YEARLY_GOAL = 52;

Â  Â  Â  Â  // Initialize Firebase
Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const auth = getAuth(app);
Â  Â  Â  Â  const db = getFirestore(app);

Â  Â  Â  Â  // --- Helper Functions ---
Â  Â  Â  Â  const parseGenre = (categories) => {
Â  Â  Â  Â  Â  Â  if (!categories || categories.length === 0) return 'General';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const forbiddenTerms = ['fiction', 'non-fiction', 'general', 'biography & autobiography', 'comics & graphic novels', 'books'];
Â  Â  Â  Â  Â  Â  let potentialGenres = [];

Â  Â  Â  Â  Â  Â  for (const category of categories) {
Â  Â  Â  Â  Â  Â  Â  Â  const parts = category.split(/ \/ | > /);
Â  Â  Â  Â  Â  Â  Â  Â  for (const part of parts) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cleanPart = part.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (cleanPart && !forbiddenTerms.includes(cleanPart.toLowerCase())) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  potentialGenres.push(cleanPart);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return potentialGenres.length > 0 ? potentialGenres[potentialGenres.length - 1] : 'General';
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  const isNonFiction = (categories) => {
Â  Â  Â  Â  Â  Â  if (!categories || categories.length === 0) return false;
Â  Â  Â  Â  Â  Â  const nonFictionKeywords = ['biography', 'autobiography', 'history', 'science', 'business', 'psychology', 'self-help', 'memoir', 'true crime', 'nonfiction'];
Â  Â  Â  Â  Â  Â  const categoryString = categories.join(' ').toLowerCase();
Â  Â  Â  Â  Â  Â  return nonFictionKeywords.some(keyword => categoryString.includes(keyword));
Â  Â  Â  Â  };

Â  Â  Â  Â  const sanitizeIsbn = (isbn) => {
Â  Â  Â  Â  Â  Â  return isbn.replace(/[-\s]/g, '');
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- UI Components ---
Â  Â  Â  Â  function ConfirmationModal({ isOpen, message, onConfirm, onCancel }) {
Â  Â  Â  Â  Â  Â  if (!isOpen) return null;

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-white mb-4">{message}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-end gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={onCancel} className="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-500">Cancel</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={onConfirm} className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Confirm</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }

Â  Â  Â  Â  function GoalProgress({ count, goal, year }) {
Â  Â  Â  Â  Â  Â  const percentage = Math.min((count / goal) * 100, 100);
Â  Â  Â  Â  Â  Â  const booksLeft = goal - count;
Â  Â  Â  Â  Â  Â  const currentYear = new Date().getFullYear();
Â  Â  Â  Â  Â  Â  let progressText;

Â  Â  Â  Â  Â  Â  if (booksLeft <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  progressText = "Goal achieved! ðŸŽ‰";
Â  Â  Â  Â  Â  Â  } else if (year < currentYear) {
Â  Â  Â  Â  Â  Â  Â  Â  progressText = `You were ${booksLeft} ${booksLeft === 1 ? 'book' : 'books'} short.`;
Â  Â  Â  Â  Â  Â  } else if (year > currentYear) {
Â  Â  Â  Â  Â  Â  Â  Â  progressText = `Goal set for ${year}.`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  progressText = `${booksLeft} more to go!`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="max-w-4xl mx-auto mb-6 p-4 bg-gray-800 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="text-lg font-bold text-white">Your {year} Reading Goal</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-lg font-bold text-indigo-400">{count} / {goal}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="w-full bg-gray-700 rounded-full h-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="bg-indigo-500 h-4 rounded-full transition-all duration-500"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ width: `${percentage}%` }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-right text-sm text-gray-400 mt-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {progressText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Main App Component ---
Â  Â  Â  Â  function App() {
Â  Â  Â  Â  Â  Â  const [user, setUser] = useState(null);
Â  Â  Â  Â  Â  Â  const [loading, setLoading] = useState(true);

Â  Â  Â  Â  Â  Â  useEffect(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const unsubscribe = onAuthStateChanged(auth, (user) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setUser(user);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  return () => unsubscribe();
Â  Â  Â  Â  Â  Â  }, []);

Â  Â  Â  Â  Â  Â  if (loading) {
Â  Â  Â  Â  Â  Â  Â  Â  return <div className="flex items-center justify-center h-screen bg-gray-900 text-white">Loading...</div>;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="min-h-screen bg-gray-900 text-gray-100 font-sans">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {user ? <Dashboard user={user} /> : <Login />}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Login/Signup Component ---
Â  Â  Â  Â  function Login() {
Â  Â  Â  Â  Â  Â  const [email, setEmail] = useState('');
Â  Â  Â  Â  Â  Â  const [password, setPassword] = useState('');
Â  Â  Â  Â  Â  Â  const [error, setError] = useState('');
Â  Â  Â  Â  Â  Â  const [isSignUp, setIsSignUp] = useState(false);

Â  Â  Â  Â  Â  Â  const handleAuth = async (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  setError('');
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isSignUp) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await createUserWithEmailAndPassword(auth, email, password);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signInWithEmailAndPassword(auth, email, password);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setError(err.message);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex items-center justify-center h-screen">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="w-full max-w-md p-8 space-y-6 bg-gray-800 rounded-lg shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-2xl font-bold text-center text-white">{isSignUp ? 'Create Account' : 'Welcome Back'}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form onSubmit={handleAuth} className="space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-bold text-gray-400">Email</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="email"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={email}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setEmail(e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full p-3 mt-1 text-gray-200 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="text-sm font-bold text-gray-400">Password</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="password"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={password}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setPassword(e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full p-3 mt-1 text-gray-200 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {error && <p className="text-sm text-red-400">{error}</p>}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" className="w-full py-3 font-bold text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition duration-300">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isSignUp ? 'Sign Up' : 'Login'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-center text-gray-400">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isSignUp ? 'Already have an account?' : "Don't have an account?"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => setIsSignUp(!isSignUp)} className="ml-1 font-bold text-indigo-400 hover:underline">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isSignUp ? 'Login' : 'Sign Up'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Main Dashboard Component ---
Â  Â  Â  Â  function Dashboard({ user }) {
Â  Â  Â  Â  Â  Â  const [view, setView] = useState('gallery');
Â  Â  Â  Â  Â  Â  const [books, setBooks] = useState([]);
Â  Â  Â  Â  Â  Â  const [loadingBooks, setLoadingBooks] = useState(true);

Â  Â  Â  Â  Â  Â  const fetchBooks = useCallback(async () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!user) return;
Â  Â  Â  Â  Â  Â  Â  Â  setLoadingBooks(true);
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const q = query(collection(db, "readings"), where("userId", "==", user.uid));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const querySnapshot = await getDocs(q);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userBooks = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userBooks.sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const orderDiff = (a.orderIndex ?? Infinity) - (b.orderIndex ?? Infinity);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (orderDiff !== 0 && !isNaN(orderDiff)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return orderDiff;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dateA = new Date(a.readDate).getTime() || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dateB = new Date(b.readDate).getTime() || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return dateA - dateB;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setBooks(userBooks);
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching books:", error);
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLoadingBooks(false);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, [user]);

Â  Â  Â  Â  Â  Â  useEffect(() => {
Â  Â  Â  Â  Â  Â  Â  Â  fetchBooks();
Â  Â  Â  Â  Â  Â  }, [fetchBooks]);

Â  Â  Â  Â  Â  Â  const handleBooksChanged = () => {
Â  Â  Â  Â  Â  Â  Â  Â  fetchBooks();
Â  Â  Â  Â  Â  Â  Â  Â  setView('gallery');
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 md:p-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Navbar user={user} setView={setView} currentView={view} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <main className="mt-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {view === 'add-single' && <AddBook books={books} onBookAdded={handleBooksChanged} onCancel={() => setView('gallery')} />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {view === 'add-multiple' && <AddMultipleBooks books={books} onBooksAdded={handleBooksChanged} onCancel={() => setView('gallery')} />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {view === 'stats' && <Stats books={books} loading={loadingBooks} />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {view === 'gallery' && <BooksDisplay books={books} loading={loadingBooks} onBookUpdated={fetchBooks} setView={setView} />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {view === 'search' && <Search books={books} onCancel={() => setView('gallery')} />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Navbar Component ---
Â  Â  Â  Â  function Navbar({ user, setView, currentView }) {
Â  Â  Â  Â  Â  Â  const [isMenuOpen, setIsMenuOpen] = useState(false);
Â  Â  Â  Â  Â  Â  const activeClass = "bg-indigo-600 text-white";
Â  Â  Â  Â  Â  Â  const inactiveClass = "text-gray-300 hover:bg-gray-700 hover:text-white";

Â  Â  Â  Â  Â  Â  const NavLink = ({ view, children }) => (
Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => { setView(view); setIsMenuOpen(false); }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className={`w-full text-left px-3 py-2 rounded-md text-sm font-medium ${currentView === view ? activeClass : inactiveClass}`}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {children}
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <header className="relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex items-baseline gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 className="text-3xl font-bold text-white">Book Tracker</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="font-mono text-xs text-gray-500">v0.93</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Hamburger Button - Mobile */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => setIsMenuOpen(!isMenuOpen)} className="p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg className="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d={isMenuOpen ? "M6 18L18 6M6 6l12 12" : "M4 6h16M4 12h16M4 18h16"} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Desktop Navigation */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <nav className="hidden md:flex items-center space-x-2 bg-gray-800 p-2 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <NavLink view="gallery">Books</NavLink>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <NavLink view="stats">Stats</NavLink>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <NavLink view="search">Search</NavLink>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <NavLink view="add-single">+ Add Book</NavLink>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <NavLink view="add-multiple">+ Add Multiple</NavLink>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </nav>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="hidden md:flex items-center space-x-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-sm text-gray-400">{user.email}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => signOut(auth)} className="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700">Logout</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Mobile Menu */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isMenuOpen && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:hidden mt-4 bg-gray-800 rounded-lg p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <nav className="flex flex-col space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <NavLink view="gallery">Books</NavLink>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <NavLink view="stats">Stats</NavLink>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <NavLink view="search">Search</NavLink>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <NavLink view="add-single">+ Add Book</NavLink>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <NavLink view="add-multiple">+ Add Multiple</NavLink>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </nav>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="border-t border-gray-700 mt-4 pt-4 flex flex-col items-start space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-sm text-gray-400 w-full">{user.email}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => signOut(auth)} className="w-full text-left px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700">Logout</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  </header>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Barcode Scanner Component ---
Â  Â  Â  Â  function BarcodeScanner({ onScanSuccess, onCancel }) {
Â  Â  Â  Â  Â  Â  useEffect(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const html5QrCode = new Html5Qrcode("reader");
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const qrCodeSuccessCallback = (decodedText, decodedResult) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html5QrCode.stop()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .finally(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onScanSuccess(decodedText);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const config = { fps: 10, qrbox: { width: 250, height: 150 } };
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .catch(err => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Unable to start scanning.", err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onCancel();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  return () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (html5QrCode && html5QrCode.isScanning) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html5QrCode.stop();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Failed to stop scanner during cleanup.", err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }, [onScanSuccess, onCancel]);
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex flex-col items-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-400">Point your camera at the book's barcode</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="scanner-viewfinder">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="reader"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="scanner-scan-line"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={onCancel}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full max-w-xs px-4 py-2 font-bold bg-red-600 text-white rounded-md hover:bg-red-700"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Cancel Scan
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Add Single Book Component ---
Â  Â  Â  Â  function AddBook({ books, onBookAdded, onCancel }) {
Â  Â  Â  Â  Â  Â  const [isbn, setIsbn] = useState('');
Â  Â  Â  Â  Â  Â  const [bookData, setBookData] = useState(null);
Â  Â  Â  Â  Â  Â  const [loading, setLoading] = useState(false);
Â  Â  Â  Â  Â  Â  const [error, setError] = useState('');
Â  Â  Â  Â  Â  Â  const [readMonth, setReadMonth] = useState(new Date().getMonth());
Â  Â  Â  Â  Â  Â  const [readYear, setReadYear] = useState(new Date().getFullYear());
Â  Â  Â  Â  Â  Â  const [isAddingNewGenre, setIsAddingNewGenre] = useState(false);
Â  Â  Â  Â  Â  Â  const [isManualAdd, setIsManualAdd] = useState(false);
Â  Â  Â  Â  Â  Â  const [isScanning, setIsScanning] = useState(false);
Â  Â  Â  Â  Â  Â  const [manualFormData, setManualFormData] = useState({
Â  Â  Â  Â  Â  Â  Â  Â  title: '', author: '', isFiction: true, genre: '', pageCount: 0, coverUrl: '', country: '',
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const fictionGenres = useMemo(() => [...new Set(books.filter(b => b.isFiction).map(b => b.genre))], [books]);
Â  Â  Â  Â  Â  Â  const nonFictionGenres = useMemo(() => [...new Set(books.filter(b => !b.isFiction).map(b => b.genre))], [books]);

Â  Â  Â  Â  Â  Â  const handleIsbnSearch = useCallback(async (searchIsbn) => {
Â  Â  Â  Â  Â  Â  Â  Â  setLoading(true);
Â  Â  Â  Â  Â  Â  Â  Â  setError('');
Â  Â  Â  Â  Â  Â  Â  Â  setBookData(null);
Â  Â  Â  Â  Â  Â  Â  Â  setIsManualAdd(false);
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sanitized = sanitizeIsbn(searchIsbn);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = `https://www.googleapis.com/books/v1/volumes?q=isbn:${sanitized}${GOOGLE_BOOKS_API_KEY ? '&key=' + GOOGLE_BOOKS_API_KEY : ''}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.totalItems > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const book = data.items[0].volumeInfo;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const title = book.title || 'No Title Provided';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setBookData({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: title,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  author: book.authors ? book.authors.join(', ') : 'N/A',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isFiction: !isNonFiction(book.categories),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  genre: parseGenre(book.categories),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pageCount: book.pageCount || 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  publicationYear: book.publishedDate ? new Date(book.publishedDate).getFullYear() : 'N/A',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coverUrl: book.imageLinks?.thumbnail || `https://placehold.co/128x192/1f2937/ffffff?text=${title.split(' ').join('+')}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  country: '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setError('Book not found for this ISBN.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("API Fetch Error:", err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setError('Failed to fetch book data. Please check the ISBN and your connection.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);
Â  Â  Â  Â  Â  Â  }, []);

Â  Â  Â  Â  Â  Â  const handleScanSuccess = useCallback((decodedIsbn) => {
Â  Â  Â  Â  Â  Â  Â  Â  setIsScanning(false);
Â  Â  Â  Â  Â  Â  Â  Â  setIsbn(decodedIsbn);
Â  Â  Â  Â  Â  Â  Â  Â  handleIsbnSearch(decodedIsbn);
Â  Â  Â  Â  Â  Â  }, [handleIsbnSearch]);

Â  Â  Â  Â  Â  Â  const handleIsbnFormSubmit = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  handleIsbnSearch(isbn);
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleAddBook = async (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  if (!bookData) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const readDate = new Date(readYear, readMonth, 15).toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  Â  Â  const bookToSave = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: bookData.title,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  author: bookData.author,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isFiction: bookData.isFiction,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  genre: bookData.genre,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pageCount: Number(bookData.pageCount) || 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  publicationYear: bookData.publicationYear,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coverUrl: bookData.coverUrl,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  country: bookData.country,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isbn: sanitizeIsbn(isbn),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId: auth.currentUser.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readDate: readDate,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readYear: Number(readYear),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  orderIndex: Date.now(),
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, "readings"), bookToSave);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsbn('');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setBookData(null);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onBookAdded();
Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error adding book:", err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setError('Failed to save book.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleSaveManualBook = async (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  if (!manualFormData.title || !manualFormData.author) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setError('Title and Author are required.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const readDate = new Date(readYear, readMonth, 15).toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  Â  Â  const bookToSave = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: manualFormData.title,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  author: manualFormData.author,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isFiction: manualFormData.isFiction,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  genre: manualFormData.genre,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pageCount: Number(manualFormData.pageCount) || 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coverUrl: manualFormData.coverUrl || `https://placehold.co/128x192/1f2937/ffffff?text=${manualFormData.title.split(' ').join('+')}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  country: manualFormData.country,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId: auth.currentUser.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isbn: '',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  publicationYear: 'N/A',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readDate: readDate,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readYear: Number(readYear),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  orderIndex: Date.now(),
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, "readings"), bookToSave);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsManualAdd(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setManualFormData({ title: '', author: '', isFiction: true, genre: '', pageCount: 0, coverUrl: '', country: '' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onBookAdded();
Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error adding manual book:", err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setError('Failed to save book.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const handleBookDataChange = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  const { name, value } = e.target;
Â  Â  Â  Â  Â  Â  Â  Â  if (name === 'genreSelect') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (value === 'add-new') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsAddingNewGenre(true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setBookData(prev => ({ ...prev, genre: '' }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsAddingNewGenre(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setBookData(prev => ({ ...prev, genre: value }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setBookData(prev => ({ ...prev, [name]: value }));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleManualFormChange = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  const { name, value } = e.target;

Â  Â  Â  Â  Â  Â  Â  Â  if (name === 'genreSelect') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (value === 'add-new') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsAddingNewGenre(true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setManualFormData(prev => ({ ...prev, genre: '' }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsAddingNewGenre(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setManualFormData(prev => ({ ...prev, genre: value }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else if (name === 'isFiction') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isFictionValue = value === 'true';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setManualFormData(prev => ({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...prev,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isFiction: isFictionValue,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  genre: (isFictionValue ? fictionGenres : nonFictionGenres).includes(prev.genre) ? prev.genre : ''
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setManualFormData(prev => ({ ...prev, [name]: value }));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleToggleManualAdd = () => {
Â  Â  Â  Â  Â  Â  Â  Â  setIsManualAdd(true);
Â  Â  Â  Â  Â  Â  Â  Â  setError('');
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="max-w-2xl mx-auto p-6 bg-gray-800 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-xl font-bold">{isScanning ? 'Scan Book Barcode' : (isManualAdd ? 'Add Book Manually' : 'Add a New Book')}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={isScanning ? () => setIsScanning(false) : onCancel} className="text-gray-400 hover:text-white">&times;</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isScanning ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <BarcodeScanner onScanSuccess={handleScanSuccess} onCancel={() => setIsScanning(false)} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {!isManualAdd && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-y-3 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form onSubmit={handleIsbnFormSubmit} className="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={isbn}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setIsbn(e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Enter 10 or 13-digit ISBN"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="flex-grow p-2 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" disabled={loading} className="px-4 py-2 font-bold text-white bg-indigo-600 rounded-md hover:bg-indigo-700 disabled:bg-gray-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {loading ? 'Searching...' : 'Find Book'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => setIsScanning(true)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full py-2 font-bold text-white bg-gray-600 rounded-md hover:bg-gray-500 flex items-center justify-center gap-2"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" /><path d="M3 8V4m0 12v4m18-4v4m0-12V4" /></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Scan Barcode
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {error && <p className="text-red-400 mb-4">{error}</p>}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {error === 'Book not found for this ISBN.' && !bookData && !isManualAdd && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={handleToggleManualAdd} className="px-4 py-2 font-bold text-white bg-green-600 rounded-md hover:bg-green-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Add Manually
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isManualAdd && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <form onSubmit={handleSaveManualBook} className="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-sm font-medium text-gray-400">Title*</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="text" name="title" value={manualFormData.title} onChange={handleManualFormChange} className="w-full p-2 mt-1 bg-gray-700 rounded-md text-white" required/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-sm font-medium text-gray-400">Author*</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="text" name="author" value={manualFormData.author} onChange={handleManualFormChange} className="w-full p-2 mt-1 bg-gray-700 rounded-md text-white" required/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-sm font-medium text-gray-400">Cover Image URL</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="text" name="coverUrl" value={manualFormData.coverUrl} onChange={handleManualFormChange} className="w-full p-2 mt-1 bg-gray-700 rounded-md text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-sm font-medium text-gray-400">Date Read</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="flex gap-2 mt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <select value={readMonth} onChange={e => setReadMonth(parseInt(e.target.value))} className="w-full p-2 bg-gray-700 rounded-md text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'].map((m, i) => <option key={i} value={i}>{m}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="number" value={readYear} onChange={e => setReadYear(parseInt(e.target.value))} className="w-full p-2 bg-gray-700 rounded-md text-white" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-sm font-medium text-gray-400">Type</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <select name="isFiction" value={manualFormData.isFiction} onChange={handleManualFormChange} className="w-full p-2 mt-1 bg-gray-700 rounded-md text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="true">Fiction</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="false">Non-Fiction</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-sm font-medium text-gray-400">Pages</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="number" name="pageCount" value={manualFormData.pageCount} onChange={handleManualFormChange} className="w-full p-2 mt-1 bg-gray-700 rounded-md text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-sm font-medium text-gray-400">Genre</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <select name="genreSelect" value={isAddingNewGenre ? 'add-new' : manualFormData.genre} onChange={handleManualFormChange} className="w-full p-2 mt-1 bg-gray-700 rounded-md text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="" disabled>Select a genre</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {(manualFormData.isFiction ? fictionGenres : nonFictionGenres).map(g => <option key={g} value={g}>{g}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="add-new">--- Add New Genre ---</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {isAddingNewGenre && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="text" name="genre" placeholder="New Genre" value={manualFormData.genre} onChange={handleManualFormChange} className="w-full p-2 mt-2 bg-gray-600 rounded-md text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-sm font-medium text-gray-400">Author's Country</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="text" name="country" value={manualFormData.country} onChange={handleManualFormChange} className="w-full p-2 mt-1 bg-gray-700 rounded-md text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button type="submit" className="w-full py-3 font-bold text-white bg-green-600 rounded-md hover:bg-green-700">Add Book</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {bookData && !isManualAdd && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form onSubmit={handleAddBook}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 md:grid-cols-3 gap-6 pt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:col-span-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={bookData.coverUrl} alt={bookData.title} className="w-full h-auto object-cover rounded-md shadow-lg" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:col-span-2 space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="text-2xl font-bold">{bookData.title}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-400">by {bookData.author}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-400">Date Read</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex gap-2 mt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select value={readMonth} onChange={e => setReadMonth(parseInt(e.target.value))} className="w-full p-2 bg-gray-700 rounded-md text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'].map((m, i) => <option key={i} value={i}>{m}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" value={readYear} onChange={e => setReadYear(parseInt(e.target.value))} className="w-full p-2 bg-gray-700 rounded-md text-white" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-400">Type</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="isFiction" value={bookData.isFiction} onChange={e => handleBookDataChange({ target: { name: 'isFiction', value: e.target.value === 'true' }})} className="w-full p-2 mt-1 bg-gray-700 rounded-md text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="true">Fiction</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="false">Non-Fiction</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-400">Pages</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" name="pageCount" value={bookData.pageCount} onChange={handleBookDataChange} className="w-full p-2 mt-1 bg-gray-700 rounded-md text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-400">Genre</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="genreSelect" value={isAddingNewGenre ? 'add-new' : bookData.genre} onChange={handleBookDataChange} className="w-full p-2 mt-1 bg-gray-700 rounded-md text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value={bookData.genre} disabled>{bookData.genre}</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {(bookData.isFiction ? fictionGenres : nonFictionGenres).map(g => <option key={g} value={g}>{g}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="add-new">--- Add New Genre ---</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isAddingNewGenre && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="genre" placeholder="New Genre" value={bookData.genre} onChange={handleBookDataChange} className="w-full p-2 mt-2 bg-gray-600 rounded-md text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm font-medium text-gray-400">Author's Country</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="country" value={bookData.country} onChange={handleBookDataChange} className="w-full p-2 mt-1 bg-gray-700 rounded-md text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" className="w-full py-3 font-bold text-white bg-green-600 rounded-md hover:bg-green-700">Add Book</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Add Multiple Books Component ---
Â  Â  Â  Â  function AddMultipleBooks({ books, onBooksAdded, onCancel }) {
Â  Â  Â  Â  Â  Â  const [isbnList, setIsbnList] = useState('');
Â  Â  Â  Â  Â  Â  const [foundBooks, setFoundBooks] = useState([]);
Â  Â  Â  Â  Â  Â  const [loading, setLoading] = useState(false);
Â  Â  Â  Â  Â  Â  const [error, setError] = useState('');

Â  Â  Â  Â  Â  Â  const fictionGenres = useMemo(() => [...new Set(books.filter(b => b.isFiction).map(b => b.genre))], [books]);
Â  Â  Â  Â  Â  Â  const nonFictionGenres = useMemo(() => [...new Set(books.filter(b => !b.isFiction).map(b => b.genre))], [books]);

Â  Â  Â  Â  Â  Â  const handlePaste = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  const pastedText = e.clipboardData.getData('text').trim();
Â  Â  Â  Â  Â  Â  Â  Â  if (!pastedText) return;

Â  Â  Â  Â  Â  Â  Â  Â  const separator = isbnList.trim() === '' ? '' : ', ';
Â  Â  Â  Â  Â  Â  Â  Â  setIsbnList(prevList => prevList + separator + pastedText);
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleFindBooks = async (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  setLoading(true);
Â  Â  Â  Â  Â  Â  Â  Â  setError('');
Â  Â  Â  Â  Â  Â  Â  Â  setFoundBooks([]);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const isbns = isbnList.split(/[\s,]+/).filter(isbn => isbn.trim() !== '');
Â  Â  Â  Â  Â  Â  Â  Â  if (isbns.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setError('Please enter at least one ISBN.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const bookPromises = isbns.map(async rawIsbn => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isbn = sanitizeIsbn(rawIsbn);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = `https://www.googleapis.com/books/v1/volumes?q=isbn:${isbn}${GOOGLE_BOOKS_API_KEY ? '&key=' + GOOGLE_BOOKS_API_KEY : ''}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.totalItems > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const book = data.items[0].volumeInfo;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const title = book.title || 'No Title Provided';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isbn,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: title,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  author: book.authors ? book.authors.join(', ') : 'N/A',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isFiction: !isNonFiction(book.categories),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  genre: parseGenre(book.categories),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pageCount: book.pageCount || 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  publicationYear: book.publishedDate ? new Date(book.publishedDate).getFullYear() : 'N/A',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coverUrl: book.imageLinks?.thumbnail || `https://placehold.co/128x192/1f2937/ffffff?text=${title.split(' ').join('+')}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readMonth: new Date().getMonth(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readYear: new Date().getFullYear(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  country: '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return { isbn: rawIsbn, error: 'Not Found' };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const results = await Promise.all(bookPromises);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setFoundBooks(results.map(b => ({...b, isAddingNewGenre: false })));

Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setError('An error occurred while fetching book data.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleBookDataChange = (index, field, value) => {
Â  Â  Â  Â  Â  Â  Â  Â  const updatedBooks = [...foundBooks];
Â  Â  Â  Â  Â  Â  Â  Â  if (field === 'genreSelect') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (value === 'add-new') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatedBooks[index].isAddingNewGenre = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatedBooks[index].genre = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatedBooks[index].isAddingNewGenre = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatedBooks[index].genre = value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatedBooks[index][field] = value;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  setFoundBooks(updatedBooks);
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const handleAddAllBooks = async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const booksToAdd = foundBooks.filter(book => !book.error);
Â  Â  Â  Â  Â  Â  Â  Â  if (booksToAdd.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setError('No valid books to add.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const batch = writeBatch(db);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let baseOrderIndex = Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  booksToAdd.forEach((book, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newBookRef = doc(collection(db, "readings"));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const readDate = new Date(book.readYear, book.readMonth, 15).toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const bookToSave = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: book.title,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  author: book.author,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isFiction: book.isFiction,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  genre: book.genre,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pageCount: Number(book.pageCount) || 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  publicationYear: book.publicationYear,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coverUrl: book.coverUrl,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  country: book.country,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isbn: book.isbn,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId: auth.currentUser.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readDate: readDate,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readYear: Number(book.readYear),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  orderIndex: baseOrderIndex + index,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  batch.set(newBookRef, bookToSave);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await batch.commit();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onBooksAdded();
Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error saving books:", err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setError('Failed to save books.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="max-w-4xl mx-auto p-6 bg-gray-800 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-xl font-bold">Add Multiple Books</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={onCancel} className="text-gray-400 hover:text-white">&times;</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form onSubmit={handleFindBooks} className="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={isbnList}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setIsbnList(e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPaste={handlePaste}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Paste a list of ISBNs, separated by spaces or commas"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full h-24 p-2 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" disabled={loading} className="mt-2 w-full px-4 py-2 font-bold text-white bg-indigo-600 rounded-md hover:bg-indigo-700 disabled:bg-gray-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {loading ? 'Searching...' : 'Find Books'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {error && <p className="text-red-400 mb-4">{error}</p>}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {foundBooks.length > 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {foundBooks.map((book, index) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={book.isbn} className="p-4 bg-gray-700 rounded-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {book.error ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-red-400">ISBN: {book.isbn} - Not Found</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 md:grid-cols-4 gap-4 items-start">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:col-span-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={book.coverUrl} alt={book.title} className="w-24 h-36 object-cover rounded-md" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:col-span-3 grid grid-cols-1 sm:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="font-bold">{book.title}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-400">{book.author}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Date Read</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex gap-2 mt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select value={book.readMonth} onChange={e => handleBookDataChange(index, 'readMonth', parseInt(e.target.value))} className="w-full p-2 bg-gray-600 rounded-md text-sm text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'].map((m, i) => <option key={i} value={i}>{m}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" value={book.readYear} onChange={e => handleBookDataChange(index, 'readYear', parseInt(e.target.value))} className="w-full p-2 bg-gray-600 rounded-md text-sm text-white" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-2 gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Type</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select value={book.isFiction} onChange={e => handleBookDataChange(index, 'isFiction', e.target.value === 'true')} className="w-full p-2 mt-1 bg-gray-600 rounded-md text-sm text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="true">Fiction</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="false">Non-Fiction</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Pages</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" value={book.pageCount} onChange={e => handleBookDataChange(index, 'pageCount', parseInt(e.target.value))} className="w-full p-2 mt-1 bg-gray-600 rounded-md text-sm text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Genre</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="genreSelect" value={book.isAddingNewGenre ? 'add-new' : book.genre} onChange={e => handleBookDataChange(index, 'genreSelect', e.target.value)} className="w-full p-2 mt-1 bg-gray-600 rounded-md text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value={book.genre} disabled>{book.genre}</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {(book.isFiction ? fictionGenres : nonFictionGenres).map(g => <option key={g} value={g}>{g}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="add-new">--- Add New Genre ---</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {book.isAddingNewGenre && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" placeholder="New Genre" value={book.genre} onChange={e => handleBookDataChange(index, 'genre', e.target.value)} className="w-full p-2 mt-2 bg-gray-500 rounded-md text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button onClick={handleAddAllBooks} className="mt-4 w-full py-3 font-bold text-white bg-green-600 rounded-md hover:bg-green-700">Add All Books</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Country Books Modal Component ---
Â  Â  Â  Â  function CountryBooksModal({ isOpen, country, books, onClose }) {
Â  Â  Â  Â  Â  Â  if (!isOpen) return null;

Â  Â  Â  Â  Â  Â  const sortedBooks = useMemo(() => {
Â  Â  Â  Â  Â  Â  Â  Â  return [...books].sort((a, b) => new Date(b.readDate) - new Date(a.readDate));
Â  Â  Â  Â  Â  Â  }, [books]);

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4" onClick={onClose}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="bg-gray-800 p-6 rounded-lg max-w-2xl w-full flex flex-col gap-4" onClick={e => e.stopPropagation()}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-2xl font-bold text-white">Books from {country}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={onClose} className="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="max-h-[60vh] overflow-y-auto space-y-3 pr-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {sortedBooks.length > 0 ? sortedBooks.map(book => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={book.id} className="flex items-start gap-4 p-3 bg-gray-700 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={book.coverUrl} alt={book.title} className="w-12 h-20 object-cover rounded-md flex-shrink-0"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="font-bold text-white">{book.title}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-300">{book.author}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xs text-gray-500">Read in {new Date(book.readDate).getFullYear()}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-400">No books found for this country.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={onClose} className="mt-2 ml-auto px-4 py-2 bg-indigo-600 text-white rounded-md">Close</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Decade Books Modal Component ---
Â  Â  Â  Â  function DecadeBooksModal({ isOpen, decade, books, onClose }) {
Â  Â  Â  Â  Â  Â  if (!isOpen) return null;

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4" onClick={onClose}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="bg-gray-800 p-6 rounded-lg max-w-2xl w-full flex flex-col gap-4" onClick={e => e.stopPropagation()}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-2xl font-bold text-white">Books from the {decade}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={onClose} className="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="max-h-[60vh] overflow-y-auto space-y-3 pr-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {books.length > 0 ? books.map(book => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={book.id} className="flex items-start gap-4 p-3 bg-gray-700 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={book.coverUrl} alt={book.title} className="w-12 h-20 object-cover rounded-md flex-shrink-0"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="font-bold text-white">{book.title}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-300">{book.author}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xs text-gray-500">Published in {book.publicationYear}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-400">No books found for this decade.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={onClose} className="mt-2 ml-auto px-4 py-2 bg-indigo-600 text-white rounded-md">Close</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }

Â  Â  Â  Â // --- Stats Component ---
Â  Â  Â  Â  function Stats({ books, loading }) {
Â  Â  Â  Â  Â  Â  const [year, setYear] = useState('All Time');
Â  Â  Â  Â  Â  Â  const [modalData, setModalData] = useState({ isOpen: false, country: '', books: [] });
Â  Â  Â  Â  Â  Â  const [decadeModalData, setDecadeModalData] = useState({ isOpen: false, decade: '', books: [] });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const availableYears = useMemo(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const years = new Set(books.map(b => b.readYear).filter(y => y));
Â  Â  Â  Â  Â  Â  Â  Â  const currentYear = new Date().getFullYear();
Â  Â  Â  Â  Â  Â  Â  Â  years.add(currentYear);
Â  Â  Â  Â  Â  Â  Â  Â  return ['All Time', ...Array.from(years).sort((a, b) => b - a)];
Â  Â  Â  Â  Â  Â  }, [books]);

Â  Â  Â  Â  Â  Â  const stats = useMemo(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const filteredBooks = year === 'All Time' ? books : books.filter(b => b.readYear === year);
Â  Â  Â  Â  Â  Â  Â  Â  if (filteredBooks.length === 0) return null;

Â  Â  Â  Â  Â  Â  Â  Â  const booksWithPages = filteredBooks.filter(b => b.pageCount > 0);
Â  Â  Â  Â  Â  Â  Â  Â  const totalPagesRead = filteredBooks.reduce((acc, book) => acc + Number(book.pageCount || 0), 0);
Â  Â  Â  Â  Â  Â  Â  Â  const averagePageCount = booksWithPages.length > 0 ? Math.round(totalPagesRead / booksWithPages.length) : 0;
Â  Â  Â  Â  Â  Â  Â  Â  const shortestBook = booksWithPages.length > 0 ? [...booksWithPages].sort((a, b) => a.pageCount - b.pageCount)[0] : null;
Â  Â  Â  Â  Â  Â  Â  Â  const longestBook = booksWithPages.length > 0 ? [...booksWithPages].sort((a, b) => b.pageCount - a.pageCount)[0] : null;

Â  Â  Â  Â  Â  Â  Â  Â  const fictionCount = filteredBooks.filter(b => b.isFiction).length;
Â  Â  Â  Â  Â  Â  Â  Â  const nonfictionCount = filteredBooks.length - fictionCount;

Â  Â  Â  Â  Â  Â  Â  Â  const fictionGenreCounts = filteredBooks
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(b => b.isFiction)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .reduce((acc, book) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (book.genre) acc[book.genre] = (acc[book.genre] || 0) + 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return acc;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, {});
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const nonFictionGenreCounts = filteredBooks
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(b => !b.isFiction)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .reduce((acc, book) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (book.genre) acc[book.genre] = (acc[book.genre] || 0) + 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return acc;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, {});

Â  Â  Â  Â  Â  Â  Â  Â  const authorCounts = filteredBooks.reduce((acc, book) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  acc[book.author] = (acc[book.author] || 0) + 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return acc;
Â  Â  Â  Â  Â  Â  Â  Â  }, {});
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const topAuthors = Object.entries(authorCounts)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => b[1] - a[1])
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .slice(0, 10);

Â  Â  Â  Â  Â  Â  Â  Â  const uniqueAuthors = new Set(filteredBooks.map(b => b.author)).size;

Â  Â  Â  Â  Â  Â  Â  Â  const monthlyCounts = Array(12).fill(0);
Â  Â  Â  Â  Â  Â  Â  Â  const pagesPerMonth = Array(12).fill(0);
Â  Â  Â  Â  Â  Â  Â  Â  if (year !== 'All Time') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  filteredBooks.forEach(book => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const month = new Date(book.readDate).getMonth();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  monthlyCounts[month]++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pagesPerMonth[month] += Number(book.pageCount || 0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const booksByDecade = filteredBooks.reduce((acc, book) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (book.publicationYear && !isNaN(book.publicationYear)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const decade = Math.floor(book.publicationYear / 10) * 10;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  acc[decade] = (acc[decade] || 0) + 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return acc;
Â  Â  Â  Â  Â  Â  Â  Â  }, {});
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const booksByCountry = filteredBooks.reduce((acc, book) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (book.country) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  acc[book.country] = (acc[book.country] || 0) + 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return acc;
Â  Â  Â  Â  Â  Â  Â  Â  }, {});

Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  total: filteredBooks.length, totalPagesRead, fictionCount, nonfictionCount, fictionGenreCounts, nonFictionGenreCounts,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  topAuthors,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  monthlyCounts, pagesPerMonth, averagePageCount, shortestBook, longestBook, uniqueAuthors, booksByDecade, booksByCountry
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }, [year, books]);

Â  Â  Â  Â  Â  Â  useEffect(() => {
Â  Â  Â  Â  Â  Â  Â  Â  let pieChart, fictionGenreChart, nonFictionGenreChart, lineChart, decadeChart, countryChart;
Â  Â  Â  Â  Â  Â  Â  Â  const chartInstances = [];

Â  Â  Â  Â  Â  Â  Â  Â  if (stats) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const pieCtx = document.getElementById('pie-chart')?.getContext('2d');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (pieCtx) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pieChart = new Chart(pieCtx, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'pie',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: ['Fiction', 'Non-Fiction'],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{ data: [stats.fictionCount, stats.nonfictionCount], backgroundColor: ['#818cf8', '#f87171'], borderColor: '#1f2937' }]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: { plugins: { legend: { labels: { color: 'white' }}}}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartInstances.push(pieChart);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fictionCtx = document.getElementById('fiction-genre-chart')?.getContext('2d');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fictionCtx && Object.keys(stats.fictionGenreCounts).length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sortedGenres = Object.entries(stats.fictionGenreCounts).sort((a, b) => b[1] - a[1]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fictionGenreChart = new Chart(fictionCtx, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: sortedGenres.map(item => item[0]),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{ label: 'Books per Genre', data: sortedGenres.map(item => item[1]), backgroundColor: '#818cf8' }]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: { scales: { y: { ticks: { color: 'white', stepSize: 1 }, grid: { color: '#4b5563' } }, x: { ticks: { color: 'white' } } }, plugins: { legend: { display: false }} }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartInstances.push(fictionGenreChart);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nonfictionCtx = document.getElementById('nonfiction-genre-chart')?.getContext('2d');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (nonfictionCtx && Object.keys(stats.nonFictionGenreCounts).length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sortedGenres = Object.entries(stats.nonFictionGenreCounts).sort((a, b) => b[1] - a[1]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nonFictionGenreChart = new Chart(nonfictionCtx, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: sortedGenres.map(item => item[0]),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{ label: 'Books per Genre', data: sortedGenres.map(item => item[1]), backgroundColor: '#f87171' }]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: { scales: { y: { ticks: { color: 'white', stepSize: 1 }, grid: { color: '#4b5563' } }, x: { ticks: { color: 'white' } } }, plugins: { legend: { display: false }} }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartInstances.push(nonFictionGenreChart);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (year !== 'All Time') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lineCtx = document.getElementById('line-chart')?.getContext('2d');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(lineCtx) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lineChart = new Chart(lineCtx, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'line',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{ label: 'Pages Read per Month', data: stats.pagesPerMonth, borderColor: '#818cf8', tension: 0.1 }]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: { scales: { y: { ticks: { color: 'white' }, grid: { color: '#4b5563' } }, x: { ticks: { color: 'white' } } }, plugins: { legend: { display: false }} }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartInstances.push(lineChart);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const decadeCtx = document.getElementById('decade-chart')?.getContext('2d');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (decadeCtx) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sortedDecades = Object.keys(stats.booksByDecade).sort();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  decadeChart = new Chart(decadeCtx, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: sortedDecades.map(d => `${d}s`),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{ label: 'Books by Decade', data: sortedDecades.map(d => stats.booksByDecade[d]), backgroundColor: '#818cf8' }]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick: (event, elements, chart) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (elements.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const elementIndex = elements[0].index;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const clickedDecadeLabel = chart.data.labels[elementIndex];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const clickedDecade = parseInt(clickedDecadeLabel);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const filteredBooks = year === 'All Time' ? books : books.filter(b => b.readYear === year);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const booksFromDecade = filteredBooks.filter(book => book.publicationYear && Math.floor(book.publicationYear / 10) * 10 === clickedDecade);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setDecadeModalData({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isOpen: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  decade: clickedDecadeLabel,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  books: booksFromDecade
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onHover: (event, chartElement) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const canvas = event.native.target;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.style.cursor = chartElement[0] ? 'pointer' : 'default';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scales: { y: { ticks: { color: 'white', stepSize: 1 }, grid: { color: '#4b5563' } }, x: { ticks: { color: 'white' } } },Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plugins: { legend: { display: false }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartInstances.push(decadeChart);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const countryCtx = document.getElementById('country-chart')?.getContext('2d');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (countryCtx) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  countryChart = new Chart(countryCtx, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'pie',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: Object.keys(stats.booksByCountry),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{ data: Object.values(stats.booksByCountry) }]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick: (event, elements, chart) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (elements.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const elementIndex = elements[0].index;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const clickedCountry = chart.data.labels[elementIndex];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const booksFromCountry = books.filter(book => book.country === clickedCountry);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setModalData({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isOpen: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  country: clickedCountry,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  books: booksFromCountry
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onHover: (event, chartElement) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const canvas = event.native.target;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.style.cursor = chartElement[0] ? 'pointer' : 'default';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plugins: { legend: { labels: { color: 'white' }}}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartInstances.push(countryChart);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  return () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartInstances.forEach(chart => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (chart) chart.destroy();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }, [stats, books, year]);

Â  Â  Â  Â  Â  Â  const handleCloseModal = () => setModalData({ isOpen: false, country: '', books: [] });
Â  Â  Â  Â  Â  Â  const handleCloseDecadeModal = () => setDecadeModalData({ isOpen: false, decade: '', books: [] });

Â  Â  Â  Â  Â  Â  if (loading) return <p>Loading stats...</p>;

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <CountryBooksModal
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isOpen={modalData.isOpen}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  country={modalData.country}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  books={modalData.books}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClose={handleCloseModal}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <DecadeBooksModal
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isOpen={decadeModalData.isOpen}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  decade={decadeModalData.decade}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  books={decadeModalData.books}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClose={handleCloseDecadeModal}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex items-center gap-4 mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-2xl font-bold">Statistics for</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select value={year} onChange={e => setYear(e.target.value === 'All Time' ? 'All Time' : Number(e.target.value))} className="p-2 bg-gray-700 rounded-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {availableYears.map(y => <option key={y} value={y}>{y}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {!stats ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-400">No books read for this period. Add one to see your stats!</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg"><h3 className="font-bold text-lg mb-2">Total Books Read</h3><p className="text-5xl font-bold text-indigo-400">{stats.total}</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg"><h3 className="font-bold text-lg mb-2">Total Pages Read</h3><p className="text-5xl font-bold text-indigo-400">{stats.totalPagesRead.toLocaleString()}</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg"><h3 className="font-bold text-lg mb-2">Avg. Book Length</h3><p className="text-5xl font-bold text-indigo-400">{stats.averagePageCount.toLocaleString()} pgs</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg"><h3 className="font-bold text-lg mb-2">Unique Authors</h3><p className="text-5xl font-bold text-indigo-400">{stats.uniqueAuthors}</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:col-span-2 p-4 bg-gray-800 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold text-lg mb-4">Top Authors</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {stats.topAuthors.length > 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ol className="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {stats.topAuthors.map(([author, count], index) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li key={author} className="flex justify-between items-baseline text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="flex items-center truncate">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-gray-400 font-bold w-7 text-left">{index + 1}.</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-white truncate" title={author}>{author}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="font-mono text-indigo-400 flex-shrink-0 ml-2">{count} {count > 1 ? 'books' : 'book'}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-gray-400">No authors to display.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg flex gap-4 items-start">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={stats.shortestBook?.coverUrl} className="w-1/3 h-auto object-cover rounded-md"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex-grow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold text-lg mb-2">Shortest Book</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xl font-bold text-indigo-400">{stats.shortestBook?.title || 'N/A'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-400">{stats.shortestBook?.pageCount} pgs</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg flex gap-4 items-start">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={stats.longestBook?.coverUrl} className="w-1/3 h-auto object-cover rounded-md"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex-grow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold text-lg mb-2">Longest Book</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xl font-bold text-indigo-400">{stats.longestBook?.title || 'N/A'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-400">{stats.longestBook?.pageCount} pgs</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg lg:col-span-2"><h3 className="font-bold text-lg mb-2">Fiction vs. Non-Fiction</h3><canvas id="pie-chart"></canvas></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg lg:col-span-2"><h3 className="font-bold text-lg mb-2">Books by Decade</h3><canvas id="decade-chart"></canvas></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg md:col-span-2"><h3 className="font-bold text-lg mb-2">Books by Country</h3><canvas id="country-chart"></canvas></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg md:col-span-2 lg:col-span-2"><h3 className="font-bold text-lg mb-2">Top Fiction Genres</h3><canvas id="fiction-genre-chart"></canvas></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg md:col-span-2 lg:col-span-2"><h3 className="font-bold text-lg mb-2">Top Non-Fiction Genres</h3><canvas id="nonfiction-genre-chart"></canvas></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {year !== 'All Time' && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 bg-gray-800 rounded-lg md:col-span-2 lg:col-span-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold text-lg mb-2">Monthly Reading Pace (Pages)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="line-chart"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Lightbox Component ---
Â  Â  Â  Â  function Lightbox({ book, onClose }) {
Â  Â  Â  Â  Â  Â  if (!book) return null;

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4" onClick={onClose}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="bg-gray-800 p-6 rounded-lg max-w-lg w-full flex flex-col md:flex-row gap-6" onClick={e => e.stopPropagation()}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={book.coverUrl} alt={book.title} className="w-48 h-auto object-cover rounded-md shadow-lg self-center md:self-start" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex flex-col flex-grow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-2xl font-bold text-white mb-2">{book.title}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-lg text-gray-300 mb-4">{book.author}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-y-2 text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span className="font-bold text-gray-400">Type:</span> {book.isFiction ? 'Fiction' : 'Non-Fiction'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span className="font-bold text-gray-400">Genre:</span> {book.genre}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span className="font-bold text-gray-400">Pages:</span> {book.pageCount > 0 ? book.pageCount : 'N/A'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span className="font-bold text-gray-400">Read:</span> {new Date(book.readDate).toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={onClose} className="mt-4 md:mt-auto ml-auto px-4 py-2 bg-indigo-600 text-white rounded-md">Close</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Books Display (Gallery + List) Component ---
Â  Â  Â  Â  function BooksDisplay({ books, loading, onBookUpdated, setView }) {
Â  Â  Â  Â  Â  Â  const [viewMode, setViewMode] = useState('list');
Â  Â  Â  Â  Â  Â  const [displayedBooks, setDisplayedBooks] = useState([]);
Â  Â  Â  Â  Â  Â  const [editingBookId, setEditingBookId] = useState(null);
Â  Â  Â  Â  Â  Â  const [editFormData, setEditFormData] = useState({});
Â  Â  Â  Â  Â  Â  const [lightboxBook, setLightboxBook] = useState(null);
Â  Â  Â  Â  Â  Â  const [isEditingNewGenre, setIsEditingNewGenre] = useState(false);
Â  Â  Â  Â  Â  Â  const [isBulkEditing, setIsBulkEditing] = useState(false);
Â  Â  Â  Â  Â  Â  const [bulkEditData, setBulkEditData] = useState([]);
Â  Â  Â  Â  Â  Â  const [selectedPeriod, setSelectedPeriod] = useState(new Date().getFullYear());
Â  Â  Â  Â  Â  Â  const [confirmDelete, setConfirmDelete] = useState({ isOpen: false, bookId: null });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const draggedItem = useRef(null);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const availablePeriods = useMemo(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const years = new Set(books.map(b => b.readYear).filter(y => y));
Â  Â  Â  Â  Â  Â  Â  Â  const currentYear = new Date().getFullYear();
Â  Â  Â  Â  Â  Â  Â  Â  years.add(currentYear);
Â  Â  Â  Â  Â  Â  Â  Â  return ['All Time', ...Array.from(years).sort((a, b) => b - a)];
Â  Â  Â  Â  Â  Â  }, [books]);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const fictionGenres = useMemo(() => [...new Set(books.filter(b => b.isFiction).map(b => b.genre))], [books]);
Â  Â  Â  Â  Â  Â  const nonFictionGenres = useMemo(() => [...new Set(books.filter(b => !b.isFiction).map(b => b.genre))], [books]);
Â  Â  Â  Â  Â  Â  const allCountries = useMemo(() => [...new Set(books.map(b => b.country).filter(Boolean))].sort(), [books]);

Â  Â  Â  Â  Â  Â  useEffect(() => {
Â  Â  Â  Â  Â  Â  Â  Â  let filteredBooks;
Â  Â  Â  Â  Â  Â  Â  Â  if (selectedPeriod === 'All Time') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  filteredBooks = [...books];Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  filteredBooks = books.filter(b => b.readYear === selectedPeriod);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (selectedPeriod === 'All Time') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â filteredBooks.sort((a, b) => new Date(b.readDate) - new Date(a.readDate));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  setDisplayedBooks(filteredBooks);

Â  Â  Â  Â  Â  Â  Â  Â  if (isBulkEditing && selectedPeriod !== 'All Time') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dataForEditing = filteredBooks.map(book => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const date = new Date(book.readDate);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return { ...book, readMonth: date.getMonth(), readYear: date.getFullYear(), isAddingNewGenre: false, isAddingNewCountry: false };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setBulkEditData(dataForEditing);
Â  Â  Â  Â  Â  Â  Â  Â  } else if (isBulkEditing && selectedPeriod === 'All Time') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsBulkEditing(false);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, [books, selectedPeriod, isBulkEditing]);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â const handlePeriodSelect = (period) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â setSelectedPeriod(period);
Â  Â  Â  Â  Â  Â  Â };
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â const handleDeleteRequest = (bookId) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â setConfirmDelete({ isOpen: true, bookId: bookId });
Â  Â  Â  Â  Â  Â  Â };

Â  Â  Â  Â  Â  Â  Â const confirmDeletion = async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â if (confirmDelete.bookId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â await deleteDoc(doc(db, "readings", confirmDelete.bookId));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onBookUpdated();
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â setConfirmDelete({ isOpen: false, bookId: null });
Â  Â  Â  Â  Â  Â  Â };

Â  Â  Â  Â  Â  Â  Â const cancelDeletion = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â setConfirmDelete({ isOpen: false, bookId: null });
Â  Â  Â  Â  Â  Â  Â };
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â const handleDragStart = (e, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â draggedItem.current = displayedBooks[index];
Â  Â  Â  Â  Â  Â  Â  Â  Â e.dataTransfer.effectAllowed = 'move';
Â  Â  Â  Â  Â  Â  Â };

Â  Â  Â  Â  Â  Â  Â const handleDragOver = (e, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  Â const draggedOverItem = displayedBooks[index];
Â  Â  Â  Â  Â  Â  Â  Â  Â if (draggedItem.current === draggedOverItem) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â let items = displayedBooks.filter(item => item.id !== draggedItem.current.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â items.splice(index, 0, draggedItem.current);
Â  Â  Â  Â  Â  Â  Â  Â  Â setDisplayedBooks(items);
Â  Â  Â  Â  Â  Â  Â };
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â const handleDrop = async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â const batch = writeBatch(db);
Â  Â  Â  Â  Â  Â  Â  Â  Â displayedBooks.forEach((book, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const bookRef = doc(db, "readings", book.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â batch.update(bookRef, { orderIndex: index });
Â  Â  Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  Â  Â  Â  Â  Â await batch.commit();
Â  Â  Â  Â  Â  Â  Â  Â  Â draggedItem.current = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â onBookUpdated();
Â  Â  Â  Â  Â  Â  Â };

Â  Â  Â  Â  Â  Â  Â const handleEditClick = (book) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â setEditingBookId(book.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â const date = new Date(book.readDate);
Â  Â  Â  Â  Â  Â  Â  Â  Â setEditFormData({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â title: book.title,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â author: book.author,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â coverUrl: book.coverUrl,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â readMonth: date.getMonth(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â readYear: date.getFullYear(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â pageCount: book.pageCount || 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â genre: book.genre,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â country: book.country || '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â isFiction: book.isFiction,
Â  Â  Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  Â  Â  Â };

Â  Â  Â  Â  Â  Â  Â const handleCancelEdit = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â setEditingBookId(null);
Â  Â  Â  Â  Â  Â  Â  Â  Â setIsEditingNewGenre(false);
Â  Â  Â  Â  Â  Â  Â };

Â  Â  Â  Â  Â  Â  Â const handleSaveEdit = async (bookId) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â const { readMonth, readYear, pageCount, genre, title, coverUrl, country, author, isFiction } = editFormData;
Â  Â  Â  Â  Â  Â  Â  Â  Â const newReadDate = new Date(readYear, readMonth, 15).toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â const updatedData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â readDate: newReadDate,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â pageCount: Number(pageCount),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â genre,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â title,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â author,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â isFiction,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â coverUrl,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â country,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â readYear: Number(readYear),
Â  Â  Â  Â  Â  Â  Â  Â  Â };
Â  Â  Â  Â  Â  Â  Â  Â  Â const bookRef = doc(db, "readings", bookId);
Â  Â  Â  Â  Â  Â  Â  Â  Â await updateDoc(bookRef, updatedData);
Â  Â  Â  Â  Â  Â  Â  Â  Â setEditingBookId(null);
Â  Â  Â  Â  Â  Â  Â  Â  Â setIsEditingNewGenre(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â onBookUpdated();
Â  Â  Â  Â  Â  Â  Â };

Â  Â  Â  Â  Â  Â  Â const handleEditFormChange = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â const { name, value } = e.target;
Â  Â  Â  Â  Â  Â  Â  Â  Â if (name === 'genreSelect') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (value === 'add-new') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setIsEditingNewGenre(true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setEditFormData(prev => ({ ...prev, genre: '' }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setIsEditingNewGenre(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setEditFormData(prev => ({ ...prev, genre: value }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â } else if (name === 'isFiction') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const isFictionValue = value === 'true';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setEditFormData(prev => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const newFormData = { ...prev, isFiction: isFictionValue };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const newGenreList = isFictionValue ? fictionGenres : nonFictionGenres;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (!newGenreList.includes(newFormData.genre)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â newFormData.genre = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return newFormData;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  Â  Â  Â  Â  Â } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setEditFormData(prev => ({ ...prev, [name]: value }));
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â };

Â  Â  Â  Â  Â  Â  Â const toggleBulkEdit = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â if (!isBulkEditing) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const dataForEditing = displayedBooks.map(book => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const date = new Date(book.readDate);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ...book,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â readMonth: date.getMonth(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â readYear: date.getFullYear(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â isAddingNewGenre: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â isAddingNewCountry: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setBulkEditData(dataForEditing);
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â setIsBulkEditing(!isBulkEditing);
Â  Â  Â  Â  Â  Â  Â };

Â  Â  Â  Â  Â  Â  Â const handleBulkEditChange = (index, field, value) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â const updatedData = [...bulkEditData];
Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â if (field === 'genreSelect') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (value === 'add-new') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â updatedData[index].isAddingNewGenre = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â updatedData[index].genre = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â updatedData[index].isAddingNewGenre = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â updatedData[index].genre = value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â } else if (field === 'countrySelect') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (value === 'add-new') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â updatedData[index].isAddingNewCountry = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â updatedData[index].country = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â updatedData[index].isAddingNewCountry = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â updatedData[index].country = value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â } else if (field === 'isFiction') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const isFiction = value === 'true';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â updatedData[index].isFiction = isFiction;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const newGenreList = isFiction ? fictionGenres : nonFictionGenres;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (!newGenreList.includes(updatedData[index].genre)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â updatedData[index].genre = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â updatedData[index][field] = value;
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â setBulkEditData(updatedData);
Â  Â  Â  Â  Â  Â  Â };
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â const handleSaveBulkEdit = async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const batch = writeBatch(db);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â bulkEditData.forEach(book => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const year = Number(book.readYear);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const month = Number(book.readMonth);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (isNaN(year) || isNaN(month)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â console.warn(`Skipping book "${book.title}" due to invalid date.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const bookRef = doc(db, "readings", book.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const newReadDate = new Date(year, month, 15).toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const { id, readMonth, isAddingNewGenre, isAddingNewCountry, ...dataToSave } = book;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const updatedData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ...dataToSave,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â pageCount: Number(book.pageCount) || 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â readDate: newReadDate,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â readYear: year,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â batch.update(bookRef, updatedData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â await batch.commit();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setIsBulkEditing(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onBookUpdated();
Â  Â  Â  Â  Â  Â  Â  Â  Â } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â console.error("Failed to save bulk changes:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â alert("Error: Could not save changes. Please ensure all fields like Year have valid numbers.");
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â };


Â  Â  Â  Â  Â  Â  if (loading) return <p>Loading books...</p>;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const activeClass = "bg-indigo-600 text-white";
Â  Â  Â  Â  Â  Â  const inactiveClass = "bg-gray-700 text-gray-300";

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => setView('add-single')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="md:hidden fixed bottom-6 right-6 bg-indigo-600 text-white w-14 h-14 rounded-full flex items-center justify-center shadow-lg z-40"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aria-label="Add new book"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {selectedPeriod !== 'All Time' && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <GoalProgress count={displayedBooks.length} goal={YEARLY_GOAL} year={selectedPeriod} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Lightbox book={lightboxBook} onClose={() => setLightboxBook(null)} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ConfirmationModal isOpen={confirmDelete.isOpen} message="Are you sure you want to delete this book?" onConfirm={confirmDeletion} onCancel={cancelDeletion} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="flex flex-col md:flex-row justify-between items-center mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h2 className="text-2xl font-bold mb-2 md:mb-0">Your Library</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="flex items-center bg-gray-800 p-1 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button onClick={() => setViewMode('list')} className={`px-3 py-1 rounded-md text-sm font-medium ${viewMode === 'list' ? activeClass : inactiveClass}`}>List</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button onClick={() => setViewMode('gallery')} className={`px-3 py-1 rounded-md text-sm font-medium ${viewMode === 'gallery' ? activeClass : inactiveClass}`}>Gallery</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {viewMode === 'list' && !isBulkEditing && selectedPeriod !== 'All Time' && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button onClick={toggleBulkEdit} className="px-3 py-1 rounded-md text-sm font-medium bg-yellow-600 text-white">Bulk Edit</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isBulkEditing && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-end gap-2 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={handleSaveBulkEdit} className="px-4 py-2 text-sm font-bold bg-green-600 text-white rounded-md">Save All Changes</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={toggleBulkEdit} className="px-4 py-2 text-sm bg-gray-600 text-white rounded-md">Cancel</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex flex-wrap gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {availablePeriods.map(period => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={period}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => handlePeriodSelect(period)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className={`px-4 py-2 rounded-full text-sm font-medium transition ${selectedPeriod === period ? 'bg-indigo-500 text-white' : 'bg-gray-700 text-gray-300'}`}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {period}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {displayedBooks.length === 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p className="text-gray-400">No books found for the selected period.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : viewMode === 'gallery' ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {displayedBooks.map(book => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button key={book.id} onClick={() => setLightboxBook(book)} className="focus:outline-none">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <imgÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  src={book.coverUrl}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alt={`Cover of ${book.title}`}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="w-full h-auto object-cover rounded-md shadow-lg transform hover:scale-105 transition-transform duration-300"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : isBulkEditing ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {bulkEditData.map((book, index) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div key={book.id} className="p-3 bg-gray-700 rounded-lg space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="grid grid-cols-1 md:grid-cols-10 gap-x-4 gap-y-2 items-end">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-xs font-medium text-gray-400">Title</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="text" value={book.title || ''} onChange={(e) => handleBulkEditChange(index, 'title', e.target.value)} className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-xs font-medium text-gray-400">Author</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="text" value={book.author || ''} onChange={(e) => handleBulkEditChange(index, 'author', e.target.value)} className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-xs font-medium text-gray-400">Country</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value={book.isAddingNewCountry ? 'add-new' : book.country}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onChange={(e) => handleBulkEditChange(index, 'countrySelect', e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value={book.country} disabled>{book.country || 'Select Country'}</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {allCountries.map(c => <option key={c} value={c}>{c}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="add-new">--- Add New ---</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {book.isAddingNewCountry && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â placeholder="New Country"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value={book.country}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onChange={(e) => handleBulkEditChange(index, 'country', e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â className="w-full p-1 mt-1 bg-gray-500 rounded-md text-white"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-xs font-medium text-gray-400">Type</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <select
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value={book.isFiction}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onChange={(e) => handleBulkEditChange(index, 'isFiction', e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value={true}>Fiction</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value={false}>Non-Fiction</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-xs font-medium text-gray-400">Genre</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value={book.isAddingNewGenre ? 'add-new' : book.genre}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onChange={(e) => handleBulkEditChange(index, 'genreSelect', e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value={book.genre} disabled>{book.genre || 'Select Genre'}</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {(book.isFiction ? fictionGenres : nonFictionGenres).map(g => <option key={g} value={g}>{g}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="add-new">--- Add New ---</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {book.isAddingNewGenre && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â placeholder="New Genre"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value={book.genre}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onChange={(e) => handleBulkEditChange(index, 'genre', e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â className="w-full p-1 mt-1 bg-gray-500 rounded-md text-white"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="flex gap-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-xs font-medium text-gray-400">Month</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <select
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value={book.readMonth ?? 0}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onChange={(e) => handleBulkEditChange(index, 'readMonth', parseInt(e.target.value))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'].map((m, i) => <option key={i} value={i}>{m}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label className="block text-xs font-medium text-gray-400">Pages</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type="number"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value={book.pageCount || 0}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onChange={(e) => handleBulkEditChange(index, 'pageCount', parseInt(e.target.value) || 0)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-y-4 md:space-y-0 md:border-separate md:min-w-full" style={{ borderSpacing: '0 0.75rem' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="hidden md:table-header-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:table-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:table-cell w-[4%] px-3 py-2 text-xs font-bold text-gray-400 uppercase text-center">#</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:table-cell w-[25%] px-3 py-2 text-xs font-bold text-gray-400 uppercase text-left">Title</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:table-cell w-[15%] px-3 py-2 text-xs font-bold text-gray-400 uppercase text-left">Author</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:table-cell w-[10%] px-3 py-2 text-xs font-bold text-gray-400 uppercase text-left">Country</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:table-cell w-[10%] px-3 py-2 text-xs font-bold text-gray-400 uppercase text-left">Type</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:table-cell w-[12%] px-3 py-2 text-xs font-bold text-gray-400 uppercase text-left">Genre</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:table-cell w-[8%] px-3 py-2 text-xs font-bold text-gray-400 uppercase text-left">Month</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:table-cell w-[6%] px-3 py-2 text-xs font-bold text-gray-400 uppercase text-left">Pages</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:table-cell w-[10%] px-3 py-2 text-xs font-bold text-gray-400 uppercase text-right">Actions</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:table-row-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {displayedBooks.map((book, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isEditing = editingBookId === book.id;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return isEditing ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={book.id} className="md:table-row"><div className="md:table-cell md:p-0" colSpan="9"><div className="p-3 bg-indigo-900 bg-opacity-50 rounded-lg space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Title</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="title" value={editFormData.title} onChange={handleEditFormChange} className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Author</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="author" value={editFormData.author} onChange={handleEditFormChange} className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Type</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="isFiction" value={editFormData.isFiction} onChange={handleEditFormChange} className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value={true}>Fiction</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value={false}>Non-Fiction</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Genre</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="genreSelect" value={isEditingNewGenre ? 'add-new' : editFormData.genre} onChange={handleEditFormChange} className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value={editFormData.genre} disabled>{editFormData.genre}</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {(editFormData.isFiction ? fictionGenres : nonFictionGenres).map(g => <option key={g} value={g}>{g}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="add-new">--- Add New ---</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isEditingNewGenre && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="genre" placeholder="New Genre" value={editFormData.genre} onChange={handleEditFormChange} className="w-full p-1 mt-1 bg-gray-500 rounded-md text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Country</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="country" value={editFormData.country} onChange={handleEditFormChange} className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Cover Image URL</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="coverUrl" value={editFormData.coverUrl} onChange={handleEditFormChange} className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Date</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex gap-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="readMonth" value={editFormData.readMonth} onChange={handleEditFormChange} className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'].map((m, i) => <option key={i} value={i}>{m}</option>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" name="readYear" value={editFormData.readYear} onChange={handleEditFormChange} className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label className="block text-xs font-medium text-gray-400">Pages</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" name="pageCount" value={editFormData.pageCount} onChange={handleEditFormChange} className="w-full p-1 mt-1 bg-gray-600 rounded-md text-sm text-white"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-end gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => handleSaveEdit(book.id)} className="px-3 py-1 text-xs rounded bg-green-600 text-white">Save</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={handleCancelEdit} className="px-3 py-1 text-xs rounded bg-gray-600 text-white">Cancel</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={book.id}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="bg-gray-800 rounded-lg p-4 flex flex-col gap-3 md:table-row md:p-0 md:bg-transparent hover:bg-gray-700 transition-colors duration-200 cursor-grab"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draggable={selectedPeriod !== 'All Time'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onDragStart={(e) => handleDragStart(e, index)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onDragOver={(e) => handleDragOver(e, index)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onDrop={handleDrop}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Mobile Card Layout */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex gap-4 md:hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={book.coverUrl} alt={book.title} className="w-20 h-32 object-cover rounded-md flex-shrink-0"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex flex-col justify-between w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold text-white text-lg">{book.title}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-400">{book.author}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xs text-gray-500">{book.genre} &bull; {book.pageCount} pages</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex gap-2 mt-2 self-end">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => handleEditClick(book)} className="p-2 rounded-md hover:bg-gray-600" title="Edit">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z" /></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => handleDeleteRequest(book.id)} className="p-2 rounded-md hover:bg-gray-600" title="Delete">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Desktop Table Cells */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="hidden md:table-cell p-3 text-center font-bold text-gray-400 rounded-l-lg align-middle">{index + 1}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="hidden md:table-cell p-3 align-middle">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex items-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={book.coverUrl} alt={book.title} className="w-10 h-16 object-cover rounded-md flex-shrink-0"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="font-bold text-white">{book.title}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="hidden md:table-cell p-3 text-sm text-gray-400 align-middle">{book.author}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="hidden md:table-cell p-3 text-sm text-gray-400 align-middle">{book.country || 'N/A'}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="hidden md:table-cell p-3 text-sm text-gray-400 align-middle">{book.isFiction ? 'Fiction' : 'Non-Fiction'}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="hidden md:table-cell p-3 text-sm text-gray-400 align-middle">{book.genre}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="hidden md:table-cell p-3 text-sm text-gray-400 align-middle">{new Date(book.readDate).toLocaleDateString('en-US', { month: 'short' })}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="hidden md:table-cell p-3 text-sm text-gray-400 align-middle">{book.pageCount > 0 ? book.pageCount : 'N/A'}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="hidden md:table-cell p-3 text-right rounded-r-lg align-middle">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-end gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => handleEditClick(book)} className="p-2 rounded-md hover:bg-gray-700" title="Edit">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z" /></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={() => handleDeleteRequest(book.id)} className="p-2 rounded-md hover:bg-gray-700" title="Delete">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Search Component ---
Â  Â  Â  Â  function Search({ books, onCancel }) {
Â  Â  Â  Â  Â  Â  const [searchTerm, setSearchTerm] = useState('');
Â  Â  Â  Â  Â  Â  const [searchType, setSearchType] = useState('title'); // 'title' or 'author'
Â  Â  Â  Â  Â  Â  const [results, setResults] = useState([]);
Â  Â  Â  Â  Â  Â  const [hasSearched, setHasSearched] = useState(false);

Â  Â  Â  Â  Â  Â  const handleSearch = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  if (!searchTerm.trim()) return;

Â  Â  Â  Â  Â  Â  Â  Â  const lowerCaseSearchTerm = searchTerm.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  const searchResults = books.filter(book => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (searchType === 'title') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return book.title.toLowerCase().includes(lowerCaseSearchTerm);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { // author
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return book.author.toLowerCase().includes(lowerCaseSearchTerm);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  setResults(searchResults);
Â  Â  Â  Â  Â  Â  Â  Â  setHasSearched(true);
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="max-w-4xl mx-auto p-6 bg-gray-800 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-xl font-bold">Search Your Library</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onClick={onCancel} className="text-gray-400 hover:text-white">&times;</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form onSubmit={handleSearch} className="flex flex-col sm:flex-row gap-2 mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={searchTerm}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChange={(e) => setSearchTerm(e.target.value)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder={`Search by ${searchType}...`}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className="flex-grow p-2 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select value={searchType} onChange={(e) => setSearchType(e.target.value)} className="p-2 bg-gray-700 rounded-md text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="title">Title</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="author">Author</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" className="px-4 py-2 font-bold text-white bg-indigo-600 rounded-md hover:bg-indigo-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Search
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {hasSearched && results.length > 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {results.map(book => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={book.id} className="flex items-start gap-4 p-3 bg-gray-700 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src={book.coverUrl} alt={book.title} className="w-10 h-16 object-cover rounded-md flex-shrink-0"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="font-bold text-white">{book.title}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-400">{book.author}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xs text-gray-500">Read: {new Date(book.readDate).toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {hasSearched && results.length === 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-center text-gray-400">No books found matching your search.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }

Â  Â  Â  Â  // Render the app
Â  Â  Â  Â  const container = document.getElementById('root');
Â  Â  Â  Â  const root = ReactDOM.createRoot(container);
Â  Â  Â  Â  root.render(<App />);

Â  Â  </script>
</body>
</html>
